<?xml version="1.0" encoding="UTF-8"?>
<CustomObject xmlns="http://soap.sforce.com/2006/04/metadata">
    <description>Metadata to store the fields and their masking type to be used when refreshing full and partial copy sandboxes to scrub sensitive data from the sandboxes.</description>
    <fields>
        <fullName>FieldName__c</fullName>
        <description>The field which has a PII data that needs to be masked during refreshes.</description>
        <externalId>false</externalId>
        <fieldManageability>DeveloperControlled</fieldManageability>
        <label>FieldName</label>
        <metadataRelationshipControllingField>Data_Masking_Configuration__mdt.ObjectName__c</metadataRelationshipControllingField>
        <referenceTo>FieldDefinition</referenceTo>
        <relationshipLabel>Data_Masking_Configurations</relationshipLabel>
        <relationshipName>Data_Masking_Configurations</relationshipName>
        <required>true</required>
        <type>MetadataRelationship</type>
        <unique>false</unique>
    </fields>
    <fields>
        <fullName>MaskingRule__c</fullName>
        <description>Choices for the type of masking that needs to be applied for the field.</description>
        <externalId>false</externalId>
        <fieldManageability>SubscriberControlled</fieldManageability>
        <label>MaskingRule</label>
        <required>true</required>
        <type>Picklist</type>
        <valueSet>
            <restricted>true</restricted>
            <valueSetDefinition>
                <sorted>false</sorted>
                <value>
                    <fullName>Custom String</fullName>
                    <default>true</default>
                    <label>Custom String</label>
                </value>
                <value>
                    <fullName>Random Date</fullName>
                    <default>false</default>
                    <label>Random Date</label>
                </value>
                <value>
                    <fullName>Random Email</fullName>
                    <default>false</default>
                    <label>Random Email</label>
                </value>
                <value>
                    <fullName>Random Phone</fullName>
                    <default>false</default>
                    <label>Random Phone</label>
                </value>
                <value>
                    <fullName>Random String</fullName>
                    <default>false</default>
                    <label>Random String</label>
                </value>
            </valueSetDefinition>
        </valueSet>
    </fields>
    <fields>
        <fullName>MaskingText__c</fullName>
        <description>Applicable for masking rule custom string.  Stores the custom value that needs to be replaced.</description>
        <externalId>false</externalId>
        <fieldManageability>SubscriberControlled</fieldManageability>
        <label>MaskingText</label>
        <length>255</length>
        <required>false</required>
        <type>Text</type>
        <unique>false</unique>
    </fields>
    <fields>
        <fullName>ObjectName__c</fullName>
        <description>The object which has a PII field that needs to be masked during refreshes.</description>
        <externalId>false</externalId>
        <fieldManageability>DeveloperControlled</fieldManageability>
        <label>ObjectName</label>
        <referenceTo>EntityDefinition</referenceTo>
        <relationshipLabel>Data_Masking_Configurations</relationshipLabel>
        <relationshipName>Data_Masking_Configurations</relationshipName>
        <required>true</required>
        <type>MetadataRelationship</type>
        <unique>false</unique>
    </fields>
    <label>Data Masking Configuration</label>
    <pluralLabel>Data Masking Configurations</pluralLabel>
    <validationRules>
        <fullName>Mandate_Masking_Text_for_Custom_String</fullName>
        <active>true</active>
        <description>Rule to mandate entering a value in the custom string field whenever the masking rule is selected as Custom String</description>
        <errorConditionFormula>AND(
  ISPICKVAL(MaskingRule__c, &quot;Custom String&quot;),
   ISBLANK( MaskingText__c ) 
)</errorConditionFormula>
        <errorDisplayField>MaskingText__c</errorDisplayField>
        <errorMessage>A value is required for Masking Type &quot;Custom String&quot;</errorMessage>
    </validationRules>
    <visibility>Public</visibility>
</CustomObject>
